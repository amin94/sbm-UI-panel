function openDeactiveFeatureModal(){$("#deactiveFeatures").addClass("openModal"),$(".mask").fadeIn()}function addForm(e){if(1==e){var a=$("#captureLinksBody .card").length;a+=1;var i="https://blinkco.net/order-instagram-packages/",t='<div class="col-md-12" id="captureCardGrid'+a+'"> <div class="card"> <div class="header"> <h4 class="title"> لینک '+a+'</h4> <div class="siteStatus" style="display:none" id="status'+a+'"> <p class="statusText statusSuccess" style="display:none"> <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"> <defs> <style>.cls-tick-1{fill: #00e640;}.cls-2{fill: #fff;}</style> </defs> <title>if_success_1646004</title> <circle class="cls-tick-1" cx="256" cy="256" r="256"/> <path class="cls-2" d="M375,154,194.2,334.8,137,277.7a10.89,10.89,0,1,0-15.4,15.4L186.5,358a10.86,10.86,0,0,0,15.4,0L390.4,169.5A10.93,10.93,0,0,0,375,154Z"/> </svg> اتصال برقرار شد </p><p class="statusText statusUnSuccess" style="display:none"> <svg id="Capa_1" data-name="Capa 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"> <defs> <style>.clsss-1{fill: #d75a4a;}.clsss-2{fill: none; stroke: #fff; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 2px;}</style> </defs> <title>flaticon1533587820-svg</title> <circle class="clsss-1" cx="25" cy="25" r="25"/> <polyline class="clsss-2" points="16 34 25 25 34 16"/> <polyline class="clsss-2" points="16 16 25 25 34 34"/> </svg> اتصال برقرار نشد </p><p class="statusText statusLoading" style="display:none"> <img src="../assets/img/inputLoader.svg" alt="input loader"> در حال بررسی </p></div><div class="clear"></div></div><div class="content"> <div class="row"> <div class="col-md-12"> <div class="form-group zIndexUp"> <label> لینک صفحه حاوی فرم </label> <div class="inputs"> <div class="selectBody"> <select class="conditionsSelect" name="captureConditionsInput'+a+'"> <option value="include"> شامل شود </option> <option value="exact"> دقیقا </option> </select> </div><input type="text" class="form-control captureSiteInput" onfocus="clearActions('+a+',1)" onkeyup="realType(this.value,'+a+',1)" name="siteInput'+a+'" id="siteInput'+a+'" placeholder="https://blinkco.net/order-instagram-packages/"> <div class="clear"></div></div><div onclick="test('+a+',1)" class="selectLink selectLink'+a+'" style="display:none"> <p id="siteInputLink'+a+'"> </p><span> ثبت لینک </span> <div class="clear"></div></div></div></div></div><div class="row"> <div class="col-md-6"> <div class="form-group"> <label> آیدی فیلد ایمیل </label> <input type="text" class="form-control" name="emailField'+a+'"> </div></div><div class="col-md-6"> <div class="form-group"> <label> آیدی فیلد نام (و نام خانوادگی) </label> <input type="text" class="form-control" name="nameField'+a+'"> </div></div></div></div><div class="removeBtnBody"> <a onclick="removeLink('+a+',1)" class="btn btn-fill btn-danger"> <i class="pe-7s-close-circle"></i> حذف لینک </a> </div></div></div>';$("#captureLinksBody").append(t)}else if(2==e){var s=$("#displayLinksBody .card").length;s+=1;var n="https://blinkco.net/",l='<div class="col-md-12" id="displayCardGrid'+s+'"> <div class="card"> <div class="header"> <h4 class="title"> لینک '+s+'</h4> <div class="siteStatus" style="display:none" id="displayStatus'+s+'"> <p class="statusText statusSuccess" style="display:none"> <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"> <defs> <style>.cls-tick-1{fill: #00e640;}.cls-2{fill: #fff;}</style> </defs> <title>if_success_1646004</title> <circle class="cls-tick-1" cx="256" cy="256" r="256"/> <path class="cls-2" d="M375,154,194.2,334.8,137,277.7a10.89,10.89,0,1,0-15.4,15.4L186.5,358a10.86,10.86,0,0,0,15.4,0L390.4,169.5A10.93,10.93,0,0,0,375,154Z"/> </svg> اتصال برقرار شد </p><p class="statusText statusUnSuccess" style="display:none"> <svg id="Capa_1" data-name="Capa 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"> <defs> <style>.clsss-1{fill: #d75a4a;}.clsss-2{fill: none; stroke: #fff; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 2px;}</style> </defs> <title>flaticon1533587820-svg</title> <circle class="clsss-1" cx="25" cy="25" r="25"/> <polyline class="clsss-2" points="16 34 25 25 34 16"/> <polyline class="clsss-2" points="16 16 25 25 34 34"/> </svg> اتصال برقرار نشد </p><p class="statusText statusLoading" style="display:none"> <img src="../assets/img/inputLoader.svg" alt="input loader"> در حال بررسی </p></div><div class="clear"></div></div><div class="content"> <div class="row"> <div class="col-md-12"> <div class="form-group zIndexUp"> <label> لینک صفحه نمایش نوتیفیکشن‌ها </label> <div class="inputs"> <div class="selectBody"> <select class="conditionsSelect" name="displayConditionsInput'+s+'"> <option value="include"> شامل شود </option> <option value="exact"> دقیقا </option> </select> </div><input type="text" class="form-control displaySiteInput" onfocus="clearActions('+s+',2)" onkeyup="realType(this.value,'+s+',2)" name="displaySiteInput'+s+'" id="displaySiteInput'+s+'" placeholder="https://blinkco.net/"> <div class="clear"></div></div><div onclick="test('+s+',2)" class="selectLink displaySelectLink'+s+'" style="display:none"> <p id="displaySiteInputLink'+s+'"> </p><span> ثبت لینک </span> <div class="clear"></div></div></div></div></div></div><div class="removeBtnBody"> <a onclick="removeLink('+s+',2)" class="btn btn-fill btn-danger"> <i class="pe-7s-close-circle"></i> حذف لینک </a> </div></div></div>';$("#displayLinksBody").append(l)}}function removeLink(e,a){1===a?cardSelector="captureCardGrid":2===a&&(cardSelector="displayCardGrid");var i=document.getElementById(cardSelector+e);return i.parentNode.removeChild(i),!1}function test(e,a){$(".formsMask").fadeOut();var i,t;1===a?(i="siteInput",t="status"):2==a?(i="displaySiteInput",t="displayStatus"):3==a&&(i="notifLink",t="notifLinkStatus"),$("#"+i+e).removeClass("loading"),$(".selectLink").fadeOut(),$("#"+t+e).css("display","block"),$("#"+t+e+" .statusLoading").css("display","block"),url=$("input[name="+i+e+"]").val();var s=url.substr(url.length-1);"/"!==s?(finalUrl=url+"/",$("input[name="+i+e+"]").val(finalUrl)):finalUrl=url;var n=getCookie("sbm_token"),l={formLink:finalUrl,cookie:n},o,p;o=JSON.stringify(l),p={x:o},$.ajax({type:"POST",url:"http://api.sabetmikonim.com:8004/panel/check-form-link/",data:p,dataType:"json",encode:!0}).done(function(a){console.log(a),$("#"+i+e).val(a.formLink),"linkVerified"===a.status?($("#"+t+e+" .statusLoading").css("display","none"),$("#"+t+e+" .statusSuccess").css("display","block")):($("#"+t+e+" .statusLoading").css("display","none"),$("#"+t+e+" .statusUnSuccess").css("display","block"))}).fail(function(e){console.log(e)})}function realNotif(e,a,i){if(2===a)if(1===i)var t="#hsOptionAction";else if(2===i)var t="#hsOptionCount";$(t).text(e)}function realType(e,a,i){$(".formsMask").fadeIn();var t,s,n,l;1===i?(t="siteInput",s="status",n="siteInputLink",l="selectLink"):2==i?(t="displaySiteInput",s="displayStatus",n="displaySiteInputLink",l="displaySelectLink"):3==i&&(t="notifLink",s="notifLinkStatus",n="notifLinkInput",l="notifLinkSelectLink"),$("#"+t+a).addClass("loading"),$("."+l+a).fadeIn(),$("#"+n+a).text(e)}function clearActions(e,a){var i,t;1===a?(i="siteInput",t="status"):2==a?(i="displaySiteInput",t="displayStatus"):3==a&&(i="notifLink",t="notifLinkStatus"),$("#"+t+e+" .statusText").css("display","none"),$("#"+t+e+" .siteStatus").css("display","none"),$("#"+t+e).css("display","none")}function campaignWalking(e){$(".loadingBar").removeClass("active"),$(".campaignSteps").css({display:"none"}),$("#step"+e).css({display:"block"}),$(".stepItem").removeClass("active"),$("#stepItem"+e).addClass("active"),document.getElementById("nextStep").setAttribute("onclick","campaignSteps("+(e+1)+',"next")'),document.getElementById("preStep").setAttribute("onclick","campaignSteps("+(e-1)+',"pre")'),$("a[name=nextStep]").css({display:"block"}),$("button[name=submitForm]").css({display:"none"}),0!==e&&($("a[name=preStep]").css({display:"block"}),$("a[name=nextStep]").css({display:"block"})),4===e&&($("a[name=nextStep]").css({display:"none"}),$("a[name=submitForm]").css({display:"block"}))}function campaignSteps(e,a){var i={},t={},s={},n={};if("pre"===a)campaignWalking(e);else{$(".loadingBar").addClass("active"),""===$("input[name=cidInput]").val()?cid="Null":cid=$("input[name=cidInput]").val();var l=getCookie("sbm_token"),o,p=!1;if(1===e&&(""==$("input[name=campaignName]").val()?(p=!1,$("input[name=campaignName]").addClass("error"),$(".loadingBar").removeClass("active")):(p=!0,o={step:e-1,cookie:l,campaignName:$("#step0 input[name=campaignName]").val(),cId:cid})),2===e){var c=$("input[name=notifTypeOption]").is(":checked");if(c){p=!0,$("#step"+(e-1)+" label.card").removeClass("error");var d=[];$("input[name=notifTypeOption]:checked").each(function(){d.push($(this).val())});for(var r=0;r<d.length;r++)if("recent_activity"===d[r]){var u=$("input[name=raMessage]").val(),m=$("input[name=lastConversions]").val(),v=$("input[name=lastConversionsByDay]").val(),f=$("input[name=minConversions]").val(),y,k;y=$("input[name=raCampaignLoop]").prop("checked")?"true":"false",k=$("input[name=anonymousNotif]").prop("checked")?"true":"false";var g={lastNotificationCount:m,lastNotificationDays:v,minNotificationSubmitted:f,notificationLoop:y,anonymousNotif:k};i={campaignMessage:u,campaignRules:g}}else if("hot_streak"===d[r]){var h=$("input[name=hsMessage]").val(),b=$("input[name=hsConversionName]").val(),C=$("select[name=hsPeopleKind] option:selected").val(),S=$("input[name=hsTimeRadio]:checked").val();t={hsMessage:h,hsConversionName:b,hsPeople:C,hsTime:S}}else"real_time"===d[r]?alert("real_time"):"conversion"===d[r]&&alert("conversion");var o={cId:cid,step:e-1,cookie:l,recentActivity:i,hotStreak:t,realTime:s,conversionBox:n}}else $("#step"+(e-1)+" label.card").addClass("error"),$("#step"+(e-1)+" label.card.deactiveFeature").removeClass("error"),$(".loadingBar").removeClass("active"),p=!1}if(3===e){$("#step2 input[type=text]").removeClass("error");for(var L=$("#step2 .captureSiteInput").length,I=1;L>=I;I++){if(""==$("#step2 input[name=siteInput"+I+"]").val()){$(".loadingBar").removeClass("active"),$("#step2 input[name=siteInput"+I+"]").addClass("error"),p=!1;break}if(""==$("#step2 input[name=emailField"+I+"]").val()){$(".loadingBar").removeClass("active"),$("#step2 input[name=emailField"+I+"]").addClass("error"),p=!1;break}if(""==$("#step2 input[name=nameField"+I+"]").val()){$(".loadingBar").removeClass("active"),$("#step2 input[name=nameField"+I+"]").addClass("error"),p=!1;break}p=!0;for(var x=$(".captureSiteInput").length,r=1,T=0,w,B=[];x>T;)w={formLink:$("input[name=siteInput"+r+"]").val(),condition:$("select[name=captureConditionsInput"+r+"]").val(),emailField:$("input[name=emailField"+r+"]").val(),nameField:$("input[name=nameField"+r+"]").val()},B.push(w),r+=1,T+=1;var o={cId:cid,step:e-1,cookie:l,captureLinks:B}}I=1}if(4===e){$("#step3 input[type=text]").removeClass("error");for(var D=$("#step3 .displaySiteInput").length,I=1;D>=I;I++){if(""==$("#step3 input[name=displaySiteInput"+I+"]").val()){$(".loadingBar").removeClass("active"),$("#step3 input[name=displaySiteInput"+I+"]").addClass("error"),p=!1;break}p=!0;for(var N=$(".displaySiteInput").length,r=1,T=0,O,M=[];N>T;)O={formLink:$("input[name=displaySiteInput"+r+"]").val(),condition:$("select[name=displayConditionsInput"+r+"]").val()},M.push(O),r+=1,T+=1;var o={cId:cid,step:e-1,cookie:l,displayLinks:M}}I=1}}if(p){var F,_;F=JSON.stringify(o),_={x:F},console.log(_),$.ajax({type:"POST",url:"http://api.sabetmikonim.com:8004/panel/new-campaign/",data:_,dataType:"json",async:!1,encode:!0}).done(function(a){console.log("ok! Status:"+a.status),console.log(a),"stepDone"===a.status?(1===e&&($("input[name=cidInput]").val(a.cId),a.hotStreak||($("#hsOption").prop("disabled",!0),$("#hsOptionLabel").addClass("deactiveFeature"),$("#hsOptionLabel").append('<div class="featureMask" onclick="openDeactiveFeatureModal()"></div>')),a.realTime||($("#lvOption").prop("disabled",!0),$("#lvOption").addClass("deactiveFeature"),$("#lvOptionLabel").append('<div class="featureMask" onclick="openDeactiveFeatureModal()"></div>')),a.conversionBox||($("#cbOption").prop("disabled",!0),$("#cbOption").addClass("deactiveFeature"),$("#cbOptionLabel").append('<div class="featureMask" onclick="openDeactiveFeatureModal()"></div>'))),campaignWalking(e)):"cidError"===a.status&&swal({title:"خطا!",text:"خطا در ایجاد کمپین ایجاد شده است!",icon:"error",button:"تماس با پشتیبانی: ۲۸۴۲۵۷۳۳ - ۰۲۱"})}).fail(function(e){console.log("no! "+e.status),console.log(e),swal({title:"خطا!",text:"متاسفانه ارتباط با سرور قطع شده است.",icon:"error",button:"تماس با پشتیبانی: ۲۸۴۲۵۷۳۳ - ۰۲۱"})})}}$(document).ready(function(){$("a[name=campaignStep]").click(function(e){e.preventDefault()}),$("a[name=nextStep]").click(function(e){e.preventDefault()}),$("a[name=preStep]").click(function(e){e.preventDefault()}),$("input[name=hsTimeRadio]").click(function(e){var a,i=$(this).val();"24h"===i?a=" ۲۴ ساعت ":"7d"===i?a=" ۷ روز ":"30d"===i&&(a=" ۳۰ روز "),document.getElementById("hsOptionTime").innerHTML=a}),$("form").submit(function(e){var a=this.id;$(".form-group").removeClass("has-error"),$(".help-block").remove();var i=[];$("input[name=notifTypeOption]:checked").each(function(){i.push($(this).val())});var t=$("input[name=raMessage]").val(),s=$("input[name=lastConversions]").val(),n=$("input[name=lastConversionsByDay]").val(),l=$("input[name=minConversions]").val();if(1==$("input[name=raCampaignLoop]").prop("checked"))var o=$("input[name=raCampaignLoop]").val();for(var p=$("input[name=hsMessage]").val(),c=$("input[name=hsConversionName]").val(),d=$("#hsPeopleSelect").find(":selected").val(),r=$("input[name=hsTimeRadio]:checked").val(),u=$(".captureSiteInput").length,m=1,v=0,f=[],y=[],k=[],g=[];u>v;)f[v]=$("input[name=siteInput"+m+"]").val(),g[v]=$("select[name=captureConditionsInput"+m+"]").val(),y[v]=$("input[name=emailField"+m+"]").val(),k[v]=$("input[name=nameField"+m+"]").val(),m+=1,v+=1;for(var h=$(".displaySiteInput").length,m=1,v=0,b=[],C=[];h>v;)b[v]=$("input[name=displaySiteInput"+m+"]").val(),C[v]=$("select[name=displayConditionsInput"+m+"]").val(),m+=1,v+=1;if(1==$("input[name=mobileDisplay]").prop("checked"))var S=$("input[name=mobileDisplay]").val();if(1==$("input[name=topOfMobileDisplay]").prop("checked"))var L=$("input[name=topOfMobileDisplay]").val();if(1==$("input[name=notifPosition]").prop("checked"))var I=$("input[name=notifPosition]").val();var x=$("input[name=deskNotifTime]").val(),T=$("input[name=mobileNotifTime]").val(),w=$("input[name=campaignName]").val(),B=$("input[name=cidInput]").val(),D=$("input[name=notifLink1]").val();if("newCampaign"==a){var N={requestType:"newCampaign",cid:B,campaignName:w,notifTypeOption:i,message:t,lastConversions:s,lastConversionsByDay:n,minConversions:l,raCampaignLoop:o,hsMessage:p,hsConversionName:c,hsPeopleSelect:d,hsTimeRadio:r,captureDataLink:f,captureDataEmail:y,captureDataName:k,captureCondition:g,displayDataLink:b,displayCondition:C,noMobileDisplay:S,topOfMobileDisplay:L,notifPosition:I,deskNotifTime:x,mobileNotifTime:T,notifLink:D};console.log(N)}else if("updateCampaign"==a){var N={requestType:"updateCampaign",cid:B,campaignName:w,notifTypeOption:i,message:t,lastConversions:s,lastConversionsByDay:n,minConversions:l,raCampaignLoop:o,hsMessage:p,hsConversionName:c,hsPeopleSelect:d,hsTimeRadio:r,captureDataLink:f,captureDataEmail:y,captureDataName:k,captureCondition:g,displayDataLink:b,displayCondition:C,noMobileDisplay:S,topOfMobileDisplay:L,notifPosition:I,deskNotifTime:x,mobileNotifTime:T,notifLink:D};console.log(N)}$("button[name=submitForm]").text="در حال ذخیره کمپین",$.ajax({type:"POST",url:"http://amins-macbook-pro.local:5757/sabetmikonimv2/campaign/campaignProcess.php",data:N,dataType:"json",encode:!0}).done(function(e){e.success&&setTimeout(function(){window.location.href="http://amins-macbook-pro.local:5757/sabetmikonimv2/app.php"},300)}).fail(function(e){console.log(e),$(".submit_txt").delay(200).fadeIn("fast"),$(".process_txt").fadeOut("fast"),$(".signup_btn").addClass("btn-primary"),$(".signup_btn").removeClass("signup_btn_process"),swal({title:"خطا!",text:"متاسفانه ارتباط با سرور قطع شده است.",type:"error",confirmButtonText:"دوباره تلاش کنید"})}),e.preventDefault()})});